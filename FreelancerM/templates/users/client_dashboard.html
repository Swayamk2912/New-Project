{% extends 'base.html' %}

{% block title %}Client Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Client Dashboard</h1>
    <p>Welcome, {{ user.username }} ({{ user.role|capfirst }})!</p>

    <h2>Your Posted Jobs and Received Proposals</h2>

    {% if client_jobs %}
        {% for job in client_jobs %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>{{ job.title }}</h3>
                    <p>Budget: ${{ job.budget }} | Deadline: {{ job.deadline }}</p>
                </div>
                <div class="card-body">
                    <h4>Proposals for this Job:</h4>
                    {% if job.proposals.all %}
                        <ul class="list-group">
                            {% for proposal in job.proposals.all %}
                                <li class="list-group-item">
                                    <h5>Proposal from {{ proposal.freelancer.username }}</h5>
                                    <p><strong>Message:</strong> {{ proposal.message }}</p>
                                    <p><strong>Budget:</strong> ${{ proposal.budget }}</p>
                                    <p><strong>Timeline:</strong> {{ proposal.timeline }}</p>
                                    <p><strong>Status:</strong> {{ proposal.status|capfirst }}</p>
                                    <h6>Freelancer Details:</h6>
                                    {% with freelancer_profile=proposal.freelancer.profile %}
                                        {% if freelancer_profile %}
                                            <p><strong>Full Name:</strong> {{ freelancer_profile.full_name }}</p>
                                            <p><strong>Bio:</strong> {{ freelancer_profile.bio }}</p>
                                            <p><strong>Skills:</strong> {{ freelancer_profile.skills }}</p>
                                            <p><strong>Hourly Rate:</strong> ${{ freelancer_profile.hourly_rate }}</p>
                                            <p><strong>Title:</strong> {{ freelancer_profile.title }}</p>
                                            <p><strong>Portfolio:</strong> <a href="{{ freelancer_profile.portfolio }}" target="_blank">{{ freelancer_profile.portfolio }}</a></p>
                                            <p><strong>Rating:</strong> {{ freelancer_profile.rating }}</p>
                                        {% else %}
                                            <p>No profile details available for this freelancer.</p>
                                        {% endif %}
                                    {% endwith %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No proposals received for this job yet.</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>You have not posted any jobs yet.</p>
    {% endif %}
</div>
{% endblock %}